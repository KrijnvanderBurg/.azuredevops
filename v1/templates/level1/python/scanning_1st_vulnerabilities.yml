# Level 1 template for scanning first-party code for vulnerabilities
# Combines multiple Level 0 security scanning templates

parameters:
  - name: enabled
    type: boolean
    default: true
    
  - name: continueOnError
    type: boolean
    default: true  # Security issues should be reported but not break the build by default
    
  - name: pythonSrcDirectory
    type: string
    default: $(Build.SourcesDirectory)

steps:
  - template: ../../level0/python/bandit_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}

  - template: ../../level0/python/semgrep_vuln_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}

  - template: ../../level0/python/trufflehog_secret_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}

  - template: ../../level0/python/vulture_deadcode_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}

  - template: ../../level0/python/devskim_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}

  - template: ../../level0/python/graudit_scanner.yml
    parameters:
      pythonSrcDirectory: ${{ parameters.pythonSrcDirectory }}
      continueOnError: ${{ parameters.continueOnError }}
      enabled: ${{ parameters.enabled }}
      
  - script: |
      echo "##[section]First-party code security scanning complete"
    displayName: 'Security scanning summary'
    condition: and(succeeded(), eq('${{ parameters.enabled }}', 'true'))